{
    "dashboard_name":  "SQL Server",
    "menu_name":  "Databases",
    "issue_name":  "Ensure that Vulnerability Assessment (VA) is enabled on a SQL server by setting a Storage Account",
    "description":  "Consider to enable Vulnerability Assessment (VA) service scans for critical SQL servers and corresponding SQL databases.",
    "rationale":  "Enabling Azure Defender for SQL server does not enables Vulnerability Assessment capability for individual SQL databases unless storage account is set to store the scanning data and reports.  
				   The Vulnerability Assessment service scans databases for known security vulnerabilities and highlight deviations from best practices, such as misconfigurations, excessivepermissions, and unprotected sensitive data. Results of the scan include actionable steps to resolve each issue and provide customized remediation scripts where applicable. Additionally an assessment report can be customized by setting an acceptable baseline for permission configurations, feature configurations, and database settings.",
    "impact":  "Enabling the **Azure Defender** for SQL features will incur additional costs for each SQL server.",
    "remediation":  '
					###### From Azure Console
					1. Go to `SQL servers`.
					2. Select a server instance
					3. Click on `Security Center`
					4. Select `Enable Azure Defender for SQL`
					5. In Section `Vulnerability Assessment Settings`, Click `Storage Account`
					6. Choose Storage Account (Existing or Create New). Click `Ok`
					7. Click `Save`
	',
    "references":  [
                       "https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment",
					   "https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver",
					   "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
					   "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
					   "https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessment"
                   ],
    "compliance":  [
                       {
                           "name":  "CIS Microsoft Azure Foundations",
                           "version":  "1.4.0",
                           "reference":  "4.2.2"
                       }
                   ],
    "tags":  null,
    "path":  "az_sql_servers",
    "display_path":  "az_sql_servers",
    "conditions":  [
                       "and",
                       [
                           "vulnerabilityAssessmentConfig.properties.storageContainerPath",
                           "ne",
                           "null"
                       ]
   ],
	"shouldExist":  "true",
    "returnObject":  {
                         "Azure Defender":  "Vulnerability Assessment",
                         "Status":  "Not configured"
                     },
    "id_suffix":  "sql_server_va_disabled"
}
